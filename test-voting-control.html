<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Voting Control</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
    <h1>üß™ Voting Control Test</h1>
    
    <div class="test-section">
        <h2>üìä Current Poll Configuration</h2>
        <div id="configDisplay" class="status-display">Loading...</div>
        <button class="test-button" onclick="loadConfig()">Refresh Config</button>
    </div>
    
    <div class="test-section">
        <h2>üéØ Test Individual Poll Status</h2>
        <button class="test-button" onclick="testPollStatus('poll1')">Test Poll 1</button>
        <button class="test-button" onclick="testPollStatus('poll2')">Test Poll 2</button>
        <button class="test-button" onclick="testPollStatus('poll3')">Test Poll 3</button>
        <div id="pollStatusDisplay" class="status-display">Click a button to test poll status</div>
    </div>
    
    <div class="test-section">
        <h2>üåê Test Global Voting</h2>
        <button class="test-button" onclick="testGlobalVoting()">Test Global Voting Check</button>
        <div id="globalVotingDisplay" class="status-display">Click button to test global voting</div>
    </div>
    
    <div class="test-section">
        <h2>‚öôÔ∏è Quick Admin Actions</h2>
        <button class="test-button" onclick="pausePoll1()">Pause Poll 1</button>
        <button class="test-button" onclick="activatePoll1()">Activate Poll 1</button>
        <button class="test-button" onclick="disableGlobalVoting()">Disable Global Voting</button>
        <button class="test-button" onclick="enableGlobalVoting()">Enable Global Voting</button>
        <div id="adminActionDisplay" class="status-display">Click buttons to perform admin actions</div>
    </div>
    
    <div class="test-section">
        <h2>üîó Links</h2>
        <a href="hamroawaz.html" class="test-button" style="text-decoration: none; display: inline-block;">Open Main Website</a>
        <a href="poll-admin-interface.html" class="test-button" style="text-decoration: none; display: inline-block;">Open Admin Interface</a>
    </div>

    <script>
        // Load and display current configuration
        function loadConfig() {
            const savedConfig = localStorage.getItem('hamroawaz_poll_config');
            const display = document.getElementById('configDisplay');
            
            if (savedConfig) {
                const config = JSON.parse(savedConfig);
                display.innerHTML = `
                    <strong>Global Settings:</strong><br>
                    ‚Ä¢ Allow Voting: <span class="${config.globalSettings?.allowVoting ? 'success' : 'error'}">${config.globalSettings?.allowVoting ? 'ENABLED' : 'DISABLED'}</span><br>
                    ‚Ä¢ Auto End: ${config.globalSettings?.autoEnd ? 'Enabled' : 'Disabled'}<br>
                    ‚Ä¢ Default Duration: ${config.globalSettings?.defaultDuration || 30} days<br><br>
                    <strong>Poll Statuses:</strong><br>
                    ${Object.entries(config.polls || {}).map(([pollId, poll]) => 
                        `‚Ä¢ ${pollId}: <span class="${poll.status === 'active' ? 'success' : poll.status === 'paused' ? 'warning' : 'error'}">${poll.status.toUpperCase()}</span>`
                    ).join('<br>')}
                `;
            } else {
                display.innerHTML = '<span class="warning">No configuration found in localStorage</span>';
            }
        }
        
        // Test individual poll status
        function testPollStatus(pollId) {
            const savedConfig = localStorage.getItem('hamroawaz_poll_config');
            const display = document.getElementById('pollStatusDisplay');
            
            if (savedConfig) {
                const config = JSON.parse(savedConfig);
                const poll = config.polls?.[pollId];
                
                if (poll) {
                    const status = poll.status || 'active';
                    const allowVoting = poll.allowVoting !== false;
                    const globalVoting = config.globalSettings?.allowVoting !== false;
                    
                    display.innerHTML = `
                        <strong>${pollId} Status:</strong><br>
                        ‚Ä¢ Status: <span class="${status === 'active' ? 'success' : status === 'paused' ? 'warning' : 'error'}">${status.toUpperCase()}</span><br>
                        ‚Ä¢ Poll Voting: <span class="${allowVoting ? 'success' : 'error'}">${allowVoting ? 'ALLOWED' : 'BLOCKED'}</span><br>
                        ‚Ä¢ Global Voting: <span class="${globalVoting ? 'success' : 'error'}">${globalVoting ? 'ENABLED' : 'DISABLED'}</span><br>
                        ‚Ä¢ Can Vote: <span class="${(status === 'active' && allowVoting && globalVoting) ? 'success' : 'error'}">${(status === 'active' && allowVoting && globalVoting) ? 'YES' : 'NO'}</span>
                    `;
                } else {
                    display.innerHTML = `<span class="warning">${pollId} not found in configuration</span>`;
                }
            } else {
                display.innerHTML = '<span class="error">No configuration found</span>';
            }
        }
        
        // Test global voting
        function testGlobalVoting() {
            const savedConfig = localStorage.getItem('hamroawaz_poll_config');
            const display = document.getElementById('globalVotingDisplay');
            
            if (savedConfig) {
                const config = JSON.parse(savedConfig);
                const globalVoting = config.globalSettings?.allowVoting !== false;
                
                display.innerHTML = `
                    <strong>Global Voting Status:</strong><br>
                    ‚Ä¢ Setting: <span class="${globalVoting ? 'success' : 'error'}">${globalVoting ? 'ENABLED' : 'DISABLED'}</span><br>
                    ‚Ä¢ Effect: ${globalVoting ? 'All polls can accept votes' : 'All polls are blocked from voting'}
                `;
            } else {
                display.innerHTML = '<span class="error">No configuration found</span>';
            }
        }
        
        // Admin actions
        function pausePoll1() {
            savePollStatus('poll1', 'paused');
            document.getElementById('adminActionDisplay').innerHTML = '<span class="warning">Poll 1 paused</span>';
            loadConfig();
        }
        
        function activatePoll1() {
            savePollStatus('poll1', 'active');
            document.getElementById('adminActionDisplay').innerHTML = '<span class="success">Poll 1 activated</span>';
            loadConfig();
        }
        
        function disableGlobalVoting() {
            saveGlobalVotingSetting(false);
            document.getElementById('adminActionDisplay').innerHTML = '<span class="error">Global voting disabled</span>';
            loadConfig();
        }
        
        function enableGlobalVoting() {
            saveGlobalVotingSetting(true);
            document.getElementById('adminActionDisplay').innerHTML = '<span class="success">Global voting enabled</span>';
            loadConfig();
        }
        
        // Helper functions
        function savePollStatus(pollId, status) {
            const savedConfig = localStorage.getItem('hamroawaz_poll_config');
            let config = null;
            
            if (savedConfig) {
                config = JSON.parse(savedConfig);
            } else {
                config = {
                    polls: {},
                    globalSettings: {
                        defaultDuration: 30,
                        autoEnd: true,
                        allowVoting: true
                    }
                };
            }
            
            if (!config.polls[pollId]) {
                config.polls[pollId] = {
                    status: 'active',
                    startDate: new Date().toISOString(),
                    endDate: null,
                    allowVoting: true
                };
            }
            
            config.polls[pollId].status = status;
            config.polls[pollId].allowVoting = status === 'active';
            
            localStorage.setItem('hamroawaz_poll_config', JSON.stringify(config));
        }
        
        function saveGlobalVotingSetting(allowVoting) {
            const savedConfig = localStorage.getItem('hamroawaz_poll_config');
            let config = null;
            
            if (savedConfig) {
                config = JSON.parse(savedConfig);
            } else {
                config = {
                    polls: {},
                    globalSettings: {
                        defaultDuration: 30,
                        autoEnd: true,
                        allowVoting: true
                    }
                };
            }
            
            config.globalSettings.allowVoting = allowVoting;
            localStorage.setItem('hamroawaz_poll_config', JSON.stringify(config));
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadConfig();
        });
    </script>
</body>
</html>
